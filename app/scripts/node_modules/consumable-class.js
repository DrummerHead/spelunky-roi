'use strict';

/**
 * Exports Consumable constructor
 *
 * @module consumable-class
 */

var inherits = require('inherits');
var Item = require('item-class');

/**
 * Consumable items, the investments necessary to reach Treasure
 *
 * @constructor
 * @augments {module:item-class~Item}
 * @param {object} specs - attributes passed by [spec object]{@link module:item-class~specs}
 * @param {object} announcer - [Announcer]{@link
 *   module:announcer-class~Announcer} instance, handles communication between
 *   objects
 * @param {object} config - [config]{@link module:config} object
 * @requires module:inherits
 */
var Consumable = function(specs, announcer, config){
  this.imageUrl = config.consumablePath + specs.imageUrl;
  this.category = 'consumable';
  this.listHolder = config.consumableList;

  Item.call(this, specs, announcer);

  this.announcer.publish(this.publish());

  this.liElement.addEventListener('click', this.invest.bind(this));
};

inherits(Consumable, Item);

/**
 * Signal the announcer to add item to investments
 */
Consumable.prototype.invest = function(){
  this.announcer.invest(
    {
      id: this.name,
      number: this.calculatedPrice
    }
  );
  this.select();
};

/**
 * Update Consumable item price (this.calculatedPrice) according to current
 * area and level
 * Also updates DOM this.labelElement with new price
 *
 * @param {number} area - Current area
 * @param {number} level - Current level
 * @returns {number} new price according to current area
 */
Consumable.prototype.updatePrice = function(area, level){
  var increase = 250.0 / 3;
  var completedLevels = (area - 1) * 4 + level - 1;
  this.calculatedPrice = this.initialPrice + completedLevels * increase;
  this.labelElement.textContent = Math.round(this.calculatedPrice);
  return this.calculatedPrice;
};


module.exports = Consumable;
